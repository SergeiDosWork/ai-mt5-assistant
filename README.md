# AI MT5 Торговый Ассистент

Передовая система машинного обучения для прогнозирования движений на валютном рынке и генерации торговых сигналов. Эта система использует модели глубокого обучения для анализа рыночных данных с таймфреймов M3 (3 минуты) и H1 (1 час) для прогнозирования будущих ценовых движений.

## Содержание
- [Обзор](#обзор)
- [Функции](#функции)
- [Требования](#требования)
- [Установка](#установка)
- [Использование](#использование)
- [Документация API](#документация-api)
- [Формат сервиса предсказаний](#формат-сервиса-предсказаний)
- [Разработка](#разработка)

## Обзор

AI MT5 Торговый Ассистент - это веб-сервис на основе FastAPI, который предоставляет:
- Возможности прогнозирования рынка на основе машинного обучения
- Интеграцию с MetaTrader 5 через REST API
- Поддержку как обучения модели, так и инференса
- Визуализацию текущего состояния рынка в реальном времени

## Функции

- **Анализ по нескольким таймфреймам**: Использует данные M3 (3-минутные) и H1 (1-часовые) для комплексного анализа рынка
- **Нейронная сеть**: Глубокая обучающая модель на основе LSTM для прогнозирования временных рядов
- **Технические индикаторы**: Встроенное вычисление индикаторов RSI, MACD и Squeeze momentum
- **Прогнозирование в реальном времени**: Принимает рыночные данные и возвращает торговые сигналы с оценками достоверности
- **Обучение модели**: Поддерживает обучение с историческими данными в формате parquet
- **Веб-интерфейс**: Простой веб-интерфейс для мониторинга состояния рынка и прогнозов

## Требования

### Зависимости программного обеспечения
- Python 3.8 или выше
- Менеджер пакетов pip

### Библиотеки Python
Все необходимые библиотеки Python перечислены в файле `requirements.txt`:
```text
fastapi==0.104.1
uvicorn==0.24.0
pydantic==2.5.0
torch==2.1.1
pandas==2.3.3
pyarrow==14.0.1
numpy==2.2.6
scikit-learn==1.3.2
pandas-ta==0.4.71b0
```

## Установка

### 1. Клонирование репозитория
```bash
git clone <repository-url>
cd ai-mt5-assistant
```

### 2. Настройка виртуальной среды Python (рекомендуется)
```bash
python -m venv venv
source venv/bin/activate  # В Windows: venv\\Scripts\\activate
```

### 3. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 4. Проверка установки
Убедитесь, что все зависимости установлены правильно:
```bash
python -c "import torch, pandas, fastapi, uvicorn, sklearn, pandas_ta; print('Все зависимости успешно установлены')"
```

## Использование

### 1. Запуск сервера
Запустите приложение с помощью uvicorn:
```bash
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

Сервер запустится по адресу `http://localhost:8000`

### 2. Обучение модели
Для обучения модели с историческими данными:
1. Перейдите по корневому URL (`http://localhost:8000`)
2. Загрузите файл `.parquet`, содержащий исторические рыночные данные (1-минутные свечи со столбцами: время, открытие, максимум, минимум, закрытие, объем)
3. Или используйте API-эндпоинт:
```bash
curl -X POST "http://localhost:8000/train" -F "file=@your_data.parquet"
```

### 3. Получение прогнозов
Система предоставляет два основных эндпоинта прогнозирования:
- `/forecast`: Для прогнозирования следующих 3 M3 свечей
- `/predict`: Для получения торговых сигналов из MT5

## Документация API

### Проверка работоспособности
```
GET /health
```
Возвращает информацию о состоянии сервиса.

### Эндпоинт обучения
```
POST /train
Content-Type: multipart/form-data
```
Загрузка файла parquet для обучения модели.

**Запрос:**
- Поле формы: `file` (файл parquet с историческими данными)

**Ответ:**
```json
{
  "status": "success",
  "message": "Модель успешно обучена и сохранена",
  "training_date": "2023-10-01T12:00:00",
  "train_samples": 1000
}
```

### Эндпоинт прогнозирования
```
POST /forecast
Content-Type: application/json
```
Генерация прогноза для следующих 3 M3 свечей на основе текущих 60 M3 свечей.

**Запрос:**
```json
{
  "current_candles": [
    {
      "time": "2023-10-01T10:00:00",
      "open": 1.2345,
      "high": 1.2350,
      "low": 1.2340,
      "close": 1.2348,
      "volume": 1000
    },
    // ... еще 59 свечей (всего 60)
  ]
}
```

**Ответ:**
```json
{
  "predicted_candles": [
    {
      "time": "predicted_1",
      "open": 1.2349,
      "high": 1.2354,
      "low": 1.2345,
      "close": 1.2352
    },
    // ... еще 2 спрогнозированных свечи (всего 3)
  ],
  "growth_duration": 5,
  "growth_size": 0.002
}
```

### Сервис предсказаний для MT5 (Основной эндпоинт)
```
POST /predict
Content-Type: application/json
```
Получение рыночных данных из MT5 и возврат торгового сигнала с вероятностью и уровнем достоверности.

## Формат сервиса предсказаний

### Формат запроса
Эндпоинт `/predict` ожидает JSON-объект со следующей структурой:

**Пример запроса:**
```json
{
  "symbol": "EURUSD",
  "m3": [
    {
      "time": "2023-10-01T10:00:00",
      "open": 1.2345,
      "high": 1.2350,
      "low": 1.2340,
      "close": 1.2348,
      "volume": 1000
    },
    // ... еще 59 M3 свечей (всего 60)
  ],
  "h1": [
    {
      "time": "2023-10-01T09:00:00",
      "open": 1.2330,
      "high": 1.2360,
      "low": 1.2325,
      "close": 1.2345,
      "volume": 5000
    },
    // ... еще 9 H1 свечей (всего 10)
  ]
}
```

### Формат ответа
Сервис возвращает JSON-объект с информацией о торговом сигнале:

**Пример ответа:**
```json
{
  "signal": 1,
  "probability": 0.85,
  "confidence": 0.78
}
```

### Описание полей

#### Поля запроса:
- `symbol`: Торговая пара (например, "EURUSD")
- `m3`: Массив из 60 M3 (3-минутных) свечей
  - Каждая свеча содержит: `time`, `open`, `high`, `low`, `close`, `volume`
- `h1`: Массив из 10 H1 (1-часовых) свечей  
  - Каждая свеча содержит: `time`, `open`, `high`, `low`, `close`, `volume`

#### Поля ответа:
- `signal`: Торговый сигнал (-1 для продажи, 0 для нейтрального, 1 для покупки)
- `probability`: Вероятность предполагаемого исхода (от 0.0 до 1.0)
- `confidence`: Уровень достоверности прогноза (от 0.0 до 1.0)

### Пример полного запроса и ответа

**Полный запрос:**
```json
{
  "symbol": "EURUSD",
  "m3": [
    {"time": "2023-10-01T10:00:00", "open": 1.2345, "high": 1.2350, "low": 1.2340, "close": 1.2348, "volume": 1000},
    {"time": "2023-10-01T10:03:00", "open": 1.2348, "high": 1.2353, "low": 1.2345, "close": 1.2351, "volume": 1200},
    // ... еще 58 M3 свечей
  ],
  "h1": [
    {"time": "2023-10-01T09:00:00", "open": 1.2330, "high": 1.2360, "low": 1.2325, "close": 1.2345, "volume": 5000},
    {"time": "2023-10-01T10:00:00", "open": 1.2345, "high": 1.2370, "low": 1.2340, "close": 1.2355, "volume": 6000},
    // ... еще 8 H1 свечей
  ]
}
```

**Соответствующий ответ:**
```json
{
  "signal": 1,
  "probability": 0.85,
  "confidence": 0.78
}
```

Этот ответ означает:
- Сигнал НА ПОКУПКУ (1) для EURUSD
- 85% вероятность предполагаемого движения
- 78% достоверность качества прогноза

## Разработка

### Структура проекта
```
ai-mt5-assistant/
├── main.py                 # Основное приложение FastAPI
├── model.py                # Определение и обучение нейронной сети
├── inference.py           # Логика прогнозирования и инференса
├── feature_engineering.py # Технические индикаторы и обработка данных
├── data_loader.py         # Утилиты загрузки и проверки данных
├── requirements.txt       # Зависимости Python
├── templates/             # HTML шаблоны для веб-интерфейса
└── README.md             # Этот файл
```

### Запуск тестов
В настоящее время приложение включает базовые тесты функциональности. Для запуска приложения в режиме разработки:
```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

Флаг `--reload` включает автоматическую перезагрузку при изменении кода во время разработки.